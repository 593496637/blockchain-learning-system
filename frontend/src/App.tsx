import React, { useState, useEffect } from 'react';\nimport './App.css';\nimport { api } from './api';\nimport { User, Transaction, Block, Miner, BlockchainInfo } from './types';\n\n// ç»„ä»¶ï¼šç³»ç»ŸçŠ¶æ€é¢æ¿\nconst SystemStatus: React.FC<{ info: BlockchainInfo | null }> = ({ info }) => {\n  if (!info) {\n    return (\n      <div className=\"status-panel\">\n        <h2>ğŸ”— åŒºå—é“¾ç³»ç»ŸçŠ¶æ€</h2>\n        <div className=\"loading\">åŠ è½½ä¸­...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"status-panel\">\n      <h2>ğŸ”— åŒºå—é“¾ç³»ç»ŸçŠ¶æ€</h2>\n      <div className=\"status-grid\">\n        <div className=\"status-item\">\n          <span className=\"label\">åŒºå—é«˜åº¦:</span>\n          <span className=\"value\">{info.blockHeight}</span>\n        </div>\n        <div className=\"status-item\">\n          <span className=\"label\">å¾…å¤„ç†äº¤æ˜“:</span>\n          <span className=\"value\">{info.pendingTransactionCount}</span>\n        </div>\n        <div className=\"status-item\">\n          <span className=\"label\">ç”¨æˆ·æ€»æ•°:</span>\n          <span className=\"value\">{info.totalUsers}</span>\n        </div>\n        <div className=\"status-item\">\n          <span className=\"label\">çŸ¿å·¥æ€»æ•°:</span>\n          <span className=\"value\">{info.totalMiners}</span>\n        </div>\n        <div className=\"status-item\">\n          <span className=\"label\">æŒ–çŸ¿å¥–åŠ±:</span>\n          <span className=\"value\">{info.config.blockReward} ä»£å¸</span>\n        </div>\n        <div className=\"status-item\">\n          <span className=\"label\">æŒ–çŸ¿éš¾åº¦:</span>\n          <span className=\"value\">{info.config.difficulty}</span>\n        </div>\n      </div>\n    </div>\n  );\n};\n\n// ç»„ä»¶ï¼šç”¨æˆ·ç®¡ç†\nconst UserManagement: React.FC<{ onRefresh: () => void }> = ({ onRefresh }) => {\n  const [users, setUsers] = useState<User[]>([]);\n  const [newUserName, setNewUserName] = useState('');\n  const [selectedUser, setSelectedUser] = useState<string>('');\n  const [allocateAmount, setAllocateAmount] = useState<number>(0);\n  const [loading, setLoading] = useState(false);\n  const [message, setMessage] = useState('');\n\n  const loadUsers = async () => {\n    try {\n      const response = await api.getUsers();\n      if (response.success && response.data) {\n        setUsers(response.data);\n      }\n    } catch (error) {\n      console.error('Failed to load users:', error);\n    }\n  };\n\n  useEffect(() => {\n    loadUsers();\n  }, []);\n\n  const createUser = async () => {\n    if (!newUserName.trim()) {\n      setMessage('è¯·è¾“å…¥ç”¨æˆ·å');\n      return;\n    }\n    \n    setLoading(true);\n    try {\n      const response = await api.createUser(newUserName.trim());\n      if (response.success) {\n        setMessage(`ç”¨æˆ· ${newUserName} åˆ›å»ºæˆåŠŸï¼`);\n        setNewUserName('');\n        await loadUsers();\n        onRefresh();\n      } else {\n        setMessage(`åˆ›å»ºå¤±è´¥: ${response.error}`);\n      }\n    } catch (error) {\n      setMessage('åˆ›å»ºç”¨æˆ·æ—¶å‘ç”Ÿé”™è¯¯');\n    }\n    setLoading(false);\n  };\n\n  const allocateTokens = async () => {\n    if (!selectedUser || allocateAmount <= 0) {\n      setMessage('è¯·é€‰æ‹©ç”¨æˆ·å¹¶è¾“å…¥æœ‰æ•ˆé‡‘é¢');\n      return;\n    }\n    \n    setLoading(true);\n    try {\n      const response = await api.allocateTokens(selectedUser, allocateAmount);\n      if (response.success) {\n        setMessage(`æˆåŠŸåˆ†é… ${allocateAmount} ä»£å¸ï¼`);\n        setAllocateAmount(0);\n        await loadUsers();\n        onRefresh();\n      } else {\n        setMessage(`åˆ†é…å¤±è´¥: ${response.error}`);\n      }\n    } catch (error) {\n      setMessage('åˆ†é…ä»£å¸æ—¶å‘ç”Ÿé”™è¯¯');\n    }\n    setLoading(false);\n  };\n\n  return (\n    <div className=\"management-panel\">\n      <h2>ğŸ‘¥ ç”¨æˆ·ç®¡ç†</h2>\n      \n      {/* åˆ›å»ºç”¨æˆ· */}\n      <div className=\"action-section\">\n        <h3>åˆ›å»ºæ–°ç”¨æˆ·</h3>\n        <div className=\"input-group\">\n          <input\n            type=\"text\"\n            placeholder=\"ç”¨æˆ·å\"\n            value={newUserName}\n            onChange={(e) => setNewUserName(e.target.value)}\n            disabled={loading}\n            onKeyPress={(e) => e.key === 'Enter' && createUser()}\n          />\n          <button onClick={createUser} disabled={loading || !newUserName.trim()}>\n            {loading ? 'åˆ›å»ºä¸­...' : 'åˆ›å»ºç”¨æˆ·'}\n          </button>\n        </div>\n      </div>\n\n      {/* åˆ†é…ä»£å¸ */}\n      <div className=\"action-section\">\n        <h3>åˆ†é…ä»£å¸</h3>\n        <div className=\"input-group\">\n          <select\n            value={selectedUser}\n            onChange={(e) => setSelectedUser(e.target.value)}\n            disabled={loading}\n          >\n            <option value=\"\">é€‰æ‹©ç”¨æˆ·</option>\n            {users.map(user => (\n              <option key={user.address} value={user.address}>\n                {user.name} - {user.address.substring(0, 10)}...\n              </option>\n            ))}\n          </select>\n          <input\n            type=\"number\"\n            placeholder=\"ä»£å¸æ•°é‡\"\n            value={allocateAmount || ''}\n            onChange={(e) => setAllocateAmount(Number(e.target.value))}\n            disabled={loading}\n            min=\"1\"\n          />\n          <button onClick={allocateTokens} disabled={loading || !selectedUser || allocateAmount <= 0}>\n            {loading ? 'åˆ†é…ä¸­...' : 'åˆ†é…ä»£å¸'}\n          </button>\n        </div>\n      </div>\n\n      {/* ç”¨æˆ·åˆ—è¡¨ */}\n      <div className=\"list-section\">\n        <h3>ç”¨æˆ·åˆ—è¡¨ ({users.length})</h3>\n        <button onClick={loadUsers} className=\"refresh-btn\">åˆ·æ–°</button>\n        <div className=\"user-list\">\n          {users.length === 0 ? (\n            <div className=\"empty-state\">æš‚æ— ç”¨æˆ·ï¼Œè¯·å…ˆåˆ›å»ºç”¨æˆ·</div>\n          ) : (\n            users.map(user => (\n              <div key={user.address} className=\"user-item\">\n                <div className=\"user-info\">\n                  <strong>{user.name || 'åŒ¿åç”¨æˆ·'}</strong>\n                  <div className=\"user-details\">\n                    <span>åœ°å€: {user.address}</span>\n                    <span>ä½™é¢: {user.balance} ä»£å¸</span>\n                  </div>\n                </div>\n              </div>\n            ))\n          )}\n        </div>\n      </div>\n\n      {message && (\n        <div className=\"message\">\n          {message}\n          <button onClick={() => setMessage('')}>Ã—</button>\n        </div>\n      )}\n    </div>\n  );\n};\n\n// ä¸»åº”ç”¨ç»„ä»¶\nfunction App() {\n  const [activeTab, setActiveTab] = useState('status');\n  const [blockchainInfo, setBlockchainInfo] = useState<BlockchainInfo | null>(null);\n  const [users, setUsers] = useState<User[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [connectionStatus, setConnectionStatus] = useState<'connected' | 'disconnected' | 'connecting'>('connecting');\n\n  // åŠ è½½ç³»ç»Ÿä¿¡æ¯\n  const loadSystemInfo = async () => {\n    try {\n      setConnectionStatus('connecting');\n      const [infoResponse, usersResponse] = await Promise.all([\n        api.getBlockchainInfo(),\n        api.getUsers()\n      ]);\n      \n      if (infoResponse.success && infoResponse.data) {\n        setBlockchainInfo(infoResponse.data);\n      }\n      \n      if (usersResponse.success && usersResponse.data) {\n        setUsers(usersResponse.data);\n      }\n      \n      setConnectionStatus('connected');\n    } catch (error) {\n      console.error('Failed to load system info:', error);\n      setConnectionStatus('disconnected');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // åˆå§‹åŒ–å’Œå®šæœŸåˆ·æ–°\n  useEffect(() => {\n    loadSystemInfo();\n    const interval = setInterval(loadSystemInfo, 10000); // æ¯10ç§’åˆ·æ–°ä¸€æ¬¡\n    return () => clearInterval(interval);\n  }, []);\n\n  // æ‰‹åŠ¨åˆ·æ–°\n  const handleRefresh = () => {\n    loadSystemInfo();\n  };\n\n  const tabs = [\n    { id: 'status', label: 'ç³»ç»ŸçŠ¶æ€', icon: 'ğŸ“Š' },\n    { id: 'users', label: 'ç”¨æˆ·ç®¡ç†', icon: 'ğŸ‘¥' }\n  ];\n\n  if (loading) {\n    return (\n      <div className=\"app loading\">\n        <div className=\"loading-spinner\">âš¡</div>\n        <p>è¿æ¥åŒºå—é“¾ç³»ç»Ÿä¸­...</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"app\">\n      {/* å¤´éƒ¨ */}\n      <header className=\"app-header\">\n        <h1>ğŸš€ åŒºå—é“¾å­¦ä¹ ç³»ç»Ÿ</h1>\n        <div className=\"header-actions\">\n          <div className={`connection-status ${connectionStatus}`}>\n            <span className=\"status-indicator\"></span>\n            {connectionStatus === 'connected' && 'å·²è¿æ¥'}\n            {connectionStatus === 'connecting' && 'è¿æ¥ä¸­...'}\n            {connectionStatus === 'disconnected' && 'è¿æ¥å¤±è´¥'}\n          </div>\n          <button onClick={handleRefresh} className=\"refresh-button\">\n            ğŸ”„ åˆ·æ–°\n          </button>\n        </div>\n      </header>\n\n      {/* å¯¼èˆªæ ‡ç­¾ */}\n      <nav className=\"app-nav\">\n        {tabs.map(tab => (\n          <button\n            key={tab.id}\n            className={`nav-tab ${activeTab === tab.id ? 'active' : ''}`}\n            onClick={() => setActiveTab(tab.id)}\n          >\n            <span className=\"tab-icon\">{tab.icon}</span>\n            <span className=\"tab-label\">{tab.label}</span>\n          </button>\n        ))}\n      </nav>\n\n      {/* ä¸»å†…å®¹åŒºåŸŸ */}\n      <main className=\"app-main\">\n        {activeTab === 'status' && (\n          <SystemStatus info={blockchainInfo} />\n        )}\n        {activeTab === 'users' && (\n          <UserManagement onRefresh={handleRefresh} />\n        )}\n      </main>\n\n      {/* åº•éƒ¨ */}\n      <footer className=\"app-footer\">\n        <p>ğŸ“ åŒºå—é“¾å­¦ä¹ ç³»ç»Ÿ - ç†è§£åŒºå—é“¾çš„æœ€ä½³å®è·µå¹³å°</p>\n      </footer>\n    </div>\n  );\n}\n\nexport default App;\n